# Part 2: VPC & Networking
## The Network Foundation of Your Infrastructure

---

## ðŸ“‹ Table of Contents

| Section | Description |
|---------|-------------|
| [1. vpc.tf Code](#1-vpctf---the-code) | The Terraform code explained |
| [2. CIDR Blocks](#2-cidr-blocks-explained) | IP addressing made simple |
| [3. What the Module Creates](#3-what-the-module-creates) | All 15+ resources from one file |
| [4. Public vs Private Subnets](#4-public-vs-private-subnets) | The key difference |
| [5. Internet Gateway](#5-internet-gateway-igw) | How public subnets reach internet |
| [6. NAT Gateway](#6-nat-gateway) | How private subnets reach internet |
| [7. Route Tables](#7-route-tables) | Traffic direction rules |
| [8. Module Outputs](#8-module-outputs) | Values used by other resources |
| [9. Interview Questions](#9-interview-questions) | Key concepts to remember |

---

## 1. vpc.tf - The Code

### Your Complete vpc.tf File

```hcl
module "vpc" {
  source  = "terraform-aws-modules/vpc/aws"
  version = "5.21.0"

  name = "${var.project_name}-${var.environment}-vpc"
  cidr = var.vpc_cidr

  # AZs to spread subnets across
  azs = var.azs

  # Public subnets (for bastion, ALB, etc.)
  public_subnets = var.public_subnets

  # Private subnets (for app/DB later)
  private_subnets = var.private_subnets

  # NAT so private subnets can talk OUT to the internet
  enable_nat_gateway = true
  single_nat_gateway = true

  # Public subnets automatically get public IPs on launch
  map_public_ip_on_launch = true

  tags = {
    Project     = var.project_name
    Environment = var.environment
    ManagedBy   = "terraform"
  }
}
```

### Line-by-Line Explanation

| Line | Code | What It Does |
|------|------|--------------|
| 1-3 | `module "vpc" { source... }` | Use community VPC module (saves 50+ lines!) |
| 5 | `name = "${var...}-vpc"` | Names the VPC: `devOps-interview-lab-dev-vpc` |
| 6 | `cidr = var.vpc_cidr` | VPC IP range: `10.10.0.0/16` (65,536 IPs) |
| 9 | `azs = var.azs` | Spread across 2 availability zones |
| 12 | `public_subnets = ...` | Create 2 public subnets for ALB/Bastion |
| 15 | `private_subnets = ...` | Create 2 private subnets for app servers |
| 18 | `enable_nat_gateway = true` | Allow private subnets to reach internet |
| 19 | `single_nat_gateway = true` | Use 1 NAT (saves ~$32/month) |
| 22 | `map_public_ip_on_launch` | Auto-assign public IPs in public subnets |

### Why Use a Module?

Without the module, you'd write **50+ lines** to create:
- VPC resource
- Internet Gateway
- NAT Gateway + Elastic IP
- 4 Subnets (2 public, 2 private)
- 2 Route Tables (public, private)
- 4 Route Table Associations
- Routes

**With the module: ~25 lines does it all!**

---

## 2. CIDR Blocks Explained

### What is CIDR? (Like a Baby Would Understand)

Think of IP addresses like **street addresses in a city**:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     YOUR VPC = YOUR CITY                         â”‚
â”‚                       10.10.0.0/16                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚   An IP address has 4 numbers: 10 . 10 . 0 . 0                  â”‚
â”‚                                                                  â”‚
â”‚   The /16 means: "First 16 bits are LOCKED"                     â”‚
â”‚                                                                  â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚                                                          â”‚   â”‚
â”‚   â”‚     10    .    10    .    X    .    X                   â”‚   â”‚
â”‚   â”‚     â–²          â–²          â–²         â–²                   â”‚   â”‚
â”‚   â”‚     â”‚          â”‚          â”‚         â”‚                   â”‚   â”‚
â”‚   â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚   â”‚
â”‚   â”‚          LOCKED           â”‚      VARIABLE               â”‚   â”‚
â”‚   â”‚       (network part)      â”‚     (host part)             â”‚   â”‚
â”‚   â”‚                           â”‚                              â”‚   â”‚
â”‚   â”‚   These 2 numbers         These 2 numbers               â”‚   â”‚
â”‚   â”‚   NEVER change            can be 0-255 each             â”‚   â”‚
â”‚   â”‚                                                          â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                  â”‚
â”‚   Total addresses: 256 Ã— 256 = 65,536 "houses" in your city    â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Subnet = Neighborhood

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SUBNET = NEIGHBORHOOD                         â”‚
â”‚                      10.10.10.0/24                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚   /24 means: "First 24 bits are LOCKED"                         â”‚
â”‚                                                                  â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚                                                          â”‚   â”‚
â”‚   â”‚     10    .    10    .    10    .    X                  â”‚   â”‚
â”‚   â”‚     â–²          â–²          â–²          â–²                  â”‚   â”‚
â”‚   â”‚     â”‚          â”‚          â”‚          â”‚                  â”‚   â”‚
â”‚   â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚   â”‚
â”‚   â”‚              LOCKED                  â”‚    VARIABLE      â”‚   â”‚
â”‚   â”‚                                      â”‚                  â”‚   â”‚
â”‚   â”‚   First 3 numbers                    Only last number   â”‚   â”‚
â”‚   â”‚   are fixed                          can change (0-255) â”‚   â”‚
â”‚   â”‚                                                          â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                  â”‚
â”‚   Total addresses: 256 (but AWS reserves 5, so 251 usable)     â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Your CIDR Blocks

| CIDR | Type | Available IPs | Used For |
|------|------|---------------|----------|
| `10.10.0.0/16` | VPC | 65,536 | Entire network |
| `10.10.10.0/24` | Public Subnet 1 | 251 | Bastion, ALB |
| `10.10.20.0/24` | Public Subnet 2 | 251 | ALB |
| `10.10.30.0/24` | Private Subnet 1 | 251 | App servers |
| `10.10.40.0/24` | Private Subnet 2 | 251 | App servers |

### Quick CIDR Cheat Sheet

| CIDR | IPs Available | Use Case |
|------|---------------|----------|
| /16 | 65,536 | Large VPC |
| /20 | 4,096 | Medium VPC |
| /24 | 256 | Typical subnet |
| /28 | 16 | Small subnet |
| /32 | 1 | Single IP |

---

## 3. What the Module Creates

### One Module, 15+ Resources

```
module "vpc" { ... }
        â”‚
        â”‚ CREATES ALL OF THIS:
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                  â”‚
â”‚   1. aws_vpc                        (The VPC itself)            â”‚
â”‚   2. aws_internet_gateway           (Internet access)           â”‚
â”‚   3. aws_nat_gateway                (Private â†’ Internet)        â”‚
â”‚   4. aws_eip                        (Elastic IP for NAT)        â”‚
â”‚   5. aws_subnet (public AZ-a)       (10.10.10.0/24)            â”‚
â”‚   6. aws_subnet (public AZ-b)       (10.10.20.0/24)            â”‚
â”‚   7. aws_subnet (private AZ-a)      (10.10.30.0/24)            â”‚
â”‚   8. aws_subnet (private AZ-b)      (10.10.40.0/24)            â”‚
â”‚   9. aws_route_table (public)       (Routes for public)         â”‚
â”‚  10. aws_route_table (private)      (Routes for private)        â”‚
â”‚  11. aws_route (public â†’ IGW)       (0.0.0.0/0 â†’ IGW)          â”‚
â”‚  12. aws_route (private â†’ NAT)      (0.0.0.0/0 â†’ NAT)          â”‚
â”‚  13. aws_route_table_association Ã—4 (Link subnets to tables)   â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Visual: Complete VPC Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              INTERNET                                            â”‚
â”‚                                  â”‚                                               â”‚
â”‚                                  â–¼                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                         INTERNET GATEWAY                                   â”‚  â”‚
â”‚  â”‚                    (Allows public subnet traffic)                          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                    â”‚                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                        VPC: 10.10.0.0/16                                   â”‚  â”‚
â”‚  â”‚                   (devOps-interview-lab-dev-vpc)                           â”‚  â”‚
â”‚  â”‚                                                                            â”‚  â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚   â”‚        eu-west-2a              â”‚  â”‚        eu-west-2b              â”‚  â”‚  â”‚
â”‚  â”‚   â”‚                                â”‚  â”‚                                â”‚  â”‚  â”‚
â”‚  â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚  â”‚
â”‚  â”‚   â”‚  â”‚   PUBLIC SUBNET          â”‚  â”‚  â”‚  â”‚   PUBLIC SUBNET          â”‚  â”‚  â”‚  â”‚
â”‚  â”‚   â”‚  â”‚   10.10.10.0/24          â”‚  â”‚  â”‚  â”‚   10.10.20.0/24          â”‚  â”‚  â”‚  â”‚
â”‚  â”‚   â”‚  â”‚                          â”‚  â”‚  â”‚  â”‚                          â”‚  â”‚  â”‚  â”‚
â”‚  â”‚   â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚  â”‚  â”‚
â”‚  â”‚   â”‚  â”‚  â”‚Bastion â”‚ â”‚  ALB   â”‚   â”‚  â”‚  â”‚  â”‚  â”‚  ALB   â”‚ â”‚  NAT   â”‚   â”‚  â”‚  â”‚  â”‚
â”‚  â”‚   â”‚  â”‚  â”‚        â”‚ â”‚ (node) â”‚   â”‚  â”‚  â”‚  â”‚  â”‚ (node) â”‚ â”‚Gateway â”‚   â”‚  â”‚  â”‚  â”‚
â”‚  â”‚   â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜   â”‚  â”‚  â”‚  â”‚
â”‚  â”‚   â”‚  â”‚                          â”‚  â”‚  â”‚  â”‚                 â”‚        â”‚  â”‚  â”‚  â”‚
â”‚  â”‚   â”‚  â”‚  Route: 0.0.0.0/0 â†’ IGW  â”‚  â”‚  â”‚  â”‚  Route: 0.0.0.0/0 â†’ IGW â”‚  â”‚  â”‚  â”‚
â”‚  â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â”‚
â”‚  â”‚   â”‚                                â”‚  â”‚                    â”‚          â”‚  â”‚  â”‚
â”‚  â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚  â”‚
â”‚  â”‚   â”‚  â”‚   PRIVATE SUBNET         â”‚  â”‚  â”‚  â”‚   PRIVATE SUBNETâ”‚       â”‚  â”‚  â”‚  â”‚
â”‚  â”‚   â”‚  â”‚   10.10.30.0/24          â”‚  â”‚  â”‚  â”‚   10.10.40.0/24 â”‚       â”‚  â”‚  â”‚  â”‚
â”‚  â”‚   â”‚  â”‚                          â”‚  â”‚  â”‚  â”‚                 â”‚       â”‚  â”‚  â”‚  â”‚
â”‚  â”‚   â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”  â”‚  â”‚  â”‚  â”‚
â”‚  â”‚   â”‚  â”‚  â”‚    APP SERVER      â”‚  â”‚  â”‚  â”‚  â”‚  â”‚    APP SERVER     â”‚  â”‚  â”‚  â”‚  â”‚
â”‚  â”‚   â”‚  â”‚  â”‚    (from ASG)      â”‚  â”‚  â”‚  â”‚  â”‚  â”‚    (from ASG)     â”‚  â”‚  â”‚  â”‚  â”‚
â”‚  â”‚   â”‚  â”‚  â”‚    NO Public IP    â”‚  â”‚  â”‚  â”‚  â”‚  â”‚    NO Public IP   â”‚  â”‚  â”‚  â”‚  â”‚
â”‚  â”‚   â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â”‚  â”‚
â”‚  â”‚   â”‚  â”‚                          â”‚  â”‚  â”‚  â”‚                         â”‚  â”‚  â”‚  â”‚
â”‚  â”‚   â”‚  â”‚  Route: 0.0.0.0/0 â†’ NAT  â”‚  â”‚  â”‚  â”‚  Route: 0.0.0.0/0 â†’ NAT â”‚  â”‚  â”‚  â”‚
â”‚  â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â”‚
â”‚  â”‚   â”‚                                â”‚  â”‚                                â”‚  â”‚  â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚                                                                            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4. Public vs Private Subnets

### The Key Difference

| Feature | Public Subnet | Private Subnet |
|---------|---------------|----------------|
| **Route to Internet** | Via Internet Gateway | Via NAT Gateway |
| **Public IP** | Yes (auto-assigned) | No |
| **Reachable from Internet** | âœ… Yes | âŒ No |
| **Can reach Internet** | âœ… Yes | âœ… Yes (via NAT) |
| **Use for** | Bastion, ALB, NAT | App servers, Databases |

### Visual Comparison

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      PUBLIC SUBNET                               â”‚
â”‚                    (10.10.10.0/24)                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚   Route Table:                                                   â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚  Destination      â”‚  Target                             â”‚   â”‚
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚   â”‚  10.10.0.0/16     â”‚  local (stay in VPC)                â”‚   â”‚
â”‚   â”‚  0.0.0.0/0        â”‚  igw-xxxxx (INTERNET GATEWAY)  â—„â”€â”€â”€â”€â”¼â”€â”€â”€â”¤
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                  â”‚
â”‚   âœ… Instances GET public IPs                                   â”‚
â”‚   âœ… Can be reached FROM internet                               â”‚
â”‚   âœ… Can reach OUT to internet                                  â”‚
â”‚                                                                  â”‚
â”‚   WHAT LIVES HERE: Bastion, ALB, NAT Gateway                    â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      PRIVATE SUBNET                              â”‚
â”‚                    (10.10.30.0/24)                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚   Route Table:                                                   â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚  Destination      â”‚  Target                             â”‚   â”‚
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚   â”‚  10.10.0.0/16     â”‚  local (stay in VPC)                â”‚   â”‚
â”‚   â”‚  0.0.0.0/0        â”‚  nat-xxxxx (NAT GATEWAY)  â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”¤
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                  â”‚
â”‚   âŒ Instances do NOT get public IPs                            â”‚
â”‚   âŒ Cannot be reached FROM internet                            â”‚
â”‚   âœ… CAN reach OUT to internet (via NAT)                        â”‚
â”‚                                                                  â”‚
â”‚   WHAT LIVES HERE: App servers, Databases, Internal services    â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Why Put Apps in Private Subnets?

**Security! Defense in Depth:**

```
                    INTERNET
                        â”‚
                        â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚   ðŸ˜ˆ ATTACKER         â”‚
            â”‚   "I want to hack     â”‚
            â”‚    your app server"   â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         VPC                                    â”‚
â”‚                                                                â”‚
â”‚   PUBLIC SUBNET                     PRIVATE SUBNET             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚   â”‚                 â”‚              â”‚                 â”‚        â”‚
â”‚   â”‚      ALB        â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚   APP SERVER    â”‚        â”‚
â”‚   â”‚  (Port 80 only) â”‚  Internal    â”‚  (10.10.30.x)   â”‚        â”‚
â”‚   â”‚                 â”‚   traffic    â”‚                 â”‚        â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚          â–²                                  â–²                  â”‚
â”‚          â”‚                                  â”‚                  â”‚
â”‚     âœ… Attacker                        âŒ Attacker             â”‚
â”‚     CAN reach ALB                      CANNOT reach           â”‚
â”‚     (but ALB only                      app directly!          â”‚
â”‚      forwards valid                                           â”‚
â”‚      HTTP requests)                                           â”‚
â”‚                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 5. Internet Gateway (IGW)

### What is an Internet Gateway?

An IGW is a **door between your VPC and the internet**.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    INTERNET GATEWAY                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚   â€¢ ONE per VPC (automatically highly available)                â”‚
â”‚   â€¢ Allows BIDIRECTIONAL traffic (in AND out)                   â”‚
â”‚   â€¢ Only works for instances WITH public IPs                    â”‚
â”‚   â€¢ FREE! (no hourly charge)                                    â”‚
â”‚                                                                  â”‚
â”‚                         INTERNET                                 â”‚
â”‚                            â”‚                                     â”‚
â”‚                            â”‚                                     â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚                    â”‚               â”‚                            â”‚
â”‚                    â”‚   INTERNET    â”‚                            â”‚
â”‚                    â”‚   GATEWAY     â”‚â—„â”€â”€â”€â”€ Two-way door          â”‚
â”‚                    â”‚               â”‚                            â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚
â”‚                            â”‚                                     â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚              â”‚                           â”‚                      â”‚
â”‚              â–¼                           â–¼                      â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚     â”‚ PUBLIC SUBNET   â”‚         â”‚ PRIVATE SUBNET  â”‚            â”‚
â”‚     â”‚                 â”‚         â”‚                 â”‚            â”‚
â”‚     â”‚ âœ… Has route    â”‚         â”‚ âŒ No route     â”‚            â”‚
â”‚     â”‚    to IGW       â”‚         â”‚    to IGW       â”‚            â”‚
â”‚     â”‚                 â”‚         â”‚                 â”‚            â”‚
â”‚     â”‚ Traffic goes    â”‚         â”‚ Cannot use IGW  â”‚            â”‚
â”‚     â”‚ IN and OUT      â”‚         â”‚ directly        â”‚            â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### How Traffic Flows Through IGW

```
OUTBOUND (Bastion â†’ Internet):

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Bastion    â”‚     â”‚    IGW       â”‚     â”‚   Internet   â”‚
â”‚ 10.10.10.50  â”‚â”€â”€â”€â”€â–ºâ”‚              â”‚â”€â”€â”€â”€â–ºâ”‚              â”‚
â”‚              â”‚     â”‚  Translates: â”‚     â”‚  Sees:       â”‚
â”‚ Private IP   â”‚     â”‚  10.10.10.50 â”‚     â”‚  3.8.x.x     â”‚
â”‚              â”‚     â”‚  â†’ 3.8.x.x   â”‚     â”‚  (public IP) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

INBOUND (Internet â†’ Bastion):

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Internet   â”‚     â”‚    IGW       â”‚     â”‚   Bastion    â”‚
â”‚              â”‚â”€â”€â”€â”€â–ºâ”‚              â”‚â”€â”€â”€â”€â–ºâ”‚ 10.10.10.50  â”‚
â”‚  Request to  â”‚     â”‚  Translates: â”‚     â”‚              â”‚
â”‚  3.8.x.x     â”‚     â”‚  3.8.x.x     â”‚     â”‚  Receives    â”‚
â”‚              â”‚     â”‚  â†’ 10.10.10  â”‚     â”‚  request     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 6. NAT Gateway

### What is a NAT Gateway?

NAT = **Network Address Translation**

It's a **ONE-WAY door** that lets private instances reach the internet, but blocks incoming connections.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       NAT GATEWAY                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚   â€¢ Lives in a PUBLIC subnet (needs internet access)            â”‚
â”‚   â€¢ Has an Elastic IP (static public IP)                        â”‚
â”‚   â€¢ OUTBOUND only (private â†’ internet)                          â”‚
â”‚   â€¢ Blocks unsolicited INBOUND traffic                          â”‚
â”‚   â€¢ Costs ~$32/month + data transfer                            â”‚
â”‚                                                                  â”‚
â”‚                                                                  â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚                    â”‚  NAT GATEWAY    â”‚                          â”‚
â”‚                    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                          â”‚
â”‚                    â”‚  â”‚           â”‚  â”‚                          â”‚
â”‚                    â”‚  â”‚  â”€â”€â”€â”€â”€â”€â–º  â”‚  â”‚  ONE-WAY ONLY!           â”‚
â”‚                    â”‚  â”‚  OUTBOUND â”‚  â”‚                          â”‚
â”‚                    â”‚  â”‚           â”‚  â”‚                          â”‚
â”‚                    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                          â”‚
â”‚                    â”‚                 â”‚                          â”‚
â”‚                    â”‚ Elastic IP:     â”‚                          â”‚
â”‚                    â”‚ 52.x.x.x        â”‚                          â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚                             â”‚                                    â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚              â”‚                             â”‚                    â”‚
â”‚              â–¼                             â–¼                    â”‚
â”‚     âœ… App server                  âŒ Random hacker             â”‚
â”‚     CAN reach out                  CANNOT get in               â”‚
â”‚     (downloads, APIs)              (blocked!)                  â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### NAT Gateway Traffic Flow

```
STEP 1: App Server Wants Updates
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                  â”‚
â”‚   App Server (10.10.30.15) runs: yum update -y                  â”‚
â”‚                                                                  â”‚
â”‚   "I need to reach amazonlinux.default.amazonaws.com"           â”‚
â”‚   "That's on the internet... but I have no public IP!"          â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

STEP 2: Route Table Sends to NAT
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                  â”‚
â”‚   Private subnet route table:                                   â”‚
â”‚   â€¢ 10.10.0.0/16 â†’ local                                        â”‚
â”‚   â€¢ 0.0.0.0/0    â†’ NAT Gateway                                  â”‚
â”‚                                                                  â”‚
â”‚   Destination is NOT in 10.10.x.x                               â”‚
â”‚   â†’ Send to NAT Gateway                                         â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

STEP 3: NAT Translates Address
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                  â”‚
â”‚   BEFORE NAT:                    AFTER NAT:                     â”‚
â”‚   Source: 10.10.30.15    â†’      Source: 52.x.x.x (NAT's EIP)   â”‚
â”‚   Dest:   amazon.com            Dest:   amazon.com              â”‚
â”‚                                                                  â”‚
â”‚   NAT remembers: "10.10.30.15 is waiting for a response"       â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

STEP 4: Response Returns
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                  â”‚
â”‚   Amazon responds to: 52.x.x.x                                  â”‚
â”‚                                                                  â”‚
â”‚   NAT checks memory: "Ah, 10.10.30.15 was waiting!"            â”‚
â”‚   NAT forwards to: 10.10.30.15                                  â”‚
â”‚                                                                  â”‚
â”‚   App server receives packages! âœ…                              â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

STEP 5: Random Hacker Tries
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                  â”‚
â”‚   Hacker tries to connect to: 52.x.x.x                          â”‚
â”‚                                                                  â”‚
â”‚   NAT checks memory: "Nobody requested this..."                 â”‚
â”‚   NAT response: "I don't know you. BLOCKED!" âŒ                 â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### single_nat_gateway = true

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              single_nat_gateway = true (YOUR CONFIG)            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚   AZ-a                              AZ-b                        â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚   â”‚ Public Subnet       â”‚          â”‚ Public Subnet       â”‚     â”‚
â”‚   â”‚                     â”‚          â”‚                     â”‚     â”‚
â”‚   â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚          â”‚    (no NAT here)    â”‚     â”‚
â”‚   â”‚    â”‚   NAT    â”‚     â”‚          â”‚                     â”‚     â”‚
â”‚   â”‚    â”‚ Gateway  â”‚â—„â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚     â”‚
â”‚   â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚          â”‚                     â”‚     â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                  â”‚
â”‚   Private Subnet          â”€â”€â–º      Private Subnet               â”‚
â”‚   (uses NAT in AZ-a)               (also uses NAT in AZ-a)     â”‚
â”‚                                                                  â”‚
â”‚   âœ… PROS: Saves ~$32/month                                     â”‚
â”‚   âŒ CONS: If AZ-a fails, AZ-b loses internet access           â”‚
â”‚                                                                  â”‚
â”‚   FOR PRODUCTION: Use single_nat_gateway = false               â”‚
â”‚   (one NAT per AZ for high availability)                       â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 7. Route Tables

### What is a Route Table?

A route table is like a **GPS for network traffic** - it tells packets where to go.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ROUTE TABLE                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚   "If you want to go to X, take this path"                      â”‚
â”‚                                                                  â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚  Destination        â”‚  Target         â”‚  Meaning        â”‚   â”‚
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚   â”‚  10.10.0.0/16       â”‚  local          â”‚  Stay in VPC    â”‚   â”‚
â”‚   â”‚  0.0.0.0/0          â”‚  igw-xxx        â”‚  Everything     â”‚   â”‚
â”‚   â”‚                     â”‚  or nat-xxx     â”‚  else â†’ Gateway â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                  â”‚
â”‚   RULES:                                                        â”‚
â”‚   â€¢ Most specific match wins                                    â”‚
â”‚   â€¢ 0.0.0.0/0 = "everything else" (default route)              â”‚
â”‚   â€¢ "local" = deliver within the VPC                           â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Your Two Route Tables

**Public Route Table:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              PUBLIC ROUTE TABLE                                  â”‚
â”‚        (Associated with: 10.10.10.0/24, 10.10.20.0/24)         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚  Destination        â”‚  Target         â”‚  Meaning        â”‚   â”‚
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚   â”‚  10.10.0.0/16       â”‚  local          â”‚  VPC traffic    â”‚   â”‚
â”‚   â”‚  0.0.0.0/0          â”‚  igw-xxxxx      â”‚  â†’ INTERNET GW  â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                  â”‚
â”‚   EXAMPLE: Bastion (10.10.10.50) â†’ google.com                   â”‚
â”‚   â€¢ Is google.com in 10.10.0.0/16? NO                           â”‚
â”‚   â€¢ Match 0.0.0.0/0 â†’ Send to Internet Gateway                  â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Private Route Table:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              PRIVATE ROUTE TABLE                                 â”‚
â”‚        (Associated with: 10.10.30.0/24, 10.10.40.0/24)         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚  Destination        â”‚  Target         â”‚  Meaning        â”‚   â”‚
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚   â”‚  10.10.0.0/16       â”‚  local          â”‚  VPC traffic    â”‚   â”‚
â”‚   â”‚  0.0.0.0/0          â”‚  nat-xxxxx      â”‚  â†’ NAT GATEWAY  â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                  â”‚
â”‚   EXAMPLE: App (10.10.30.15) â†’ yum repository                   â”‚
â”‚   â€¢ Is yum repo in 10.10.0.0/16? NO                             â”‚
â”‚   â€¢ Match 0.0.0.0/0 â†’ Send to NAT Gateway                       â”‚
â”‚                                                                  â”‚
â”‚   EXAMPLE: App (10.10.30.15) â†’ ALB (10.10.10.100)              â”‚
â”‚   â€¢ Is 10.10.10.100 in 10.10.0.0/16? YES                        â”‚
â”‚   â€¢ Match "local" â†’ Deliver directly within VPC                 â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 8. Module Outputs

### Values Other Resources Use

The VPC module creates these **outputs** that you'll reference in other files:

```hcl
# In bastion.tf, alb.tf, app.tf, etc:

module.vpc.vpc_id              # "vpc-0abc123def..."
module.vpc.public_subnets      # ["subnet-pub1", "subnet-pub2"]
module.vpc.private_subnets     # ["subnet-priv1", "subnet-priv2"]
module.vpc.vpc_cidr_block      # "10.10.0.0/16"
```

### Where Each Output is Used

| Output | Used In | Purpose |
|--------|---------|---------|
| `module.vpc.vpc_id` | All security groups | SGs must belong to a VPC |
| `module.vpc.public_subnets` | bastion.tf, alb.tf | Place resources in public subnets |
| `module.vpc.private_subnets` | app_asg.tf | Place app servers in private subnets |
| `module.vpc.vpc_cidr_block` | app.tf (security group) | Allow traffic from within VPC |

### Example Usage

```hcl
# bastion.tf - uses public subnet
resource "aws_instance" "bastion" {
  subnet_id = module.vpc.public_subnets[0]  # First public subnet
  # ...
}

# alb.tf - uses both public subnets
resource "aws_lb" "app_alb" {
  subnets = module.vpc.public_subnets  # Both public subnets
  # ...
}

# app_asg.tf - uses private subnets
resource "aws_autoscaling_group" "app" {
  vpc_zone_identifier = module.vpc.private_subnets  # Both private subnets
  # ...
}

# app.tf - uses VPC CIDR for security group
resource "aws_security_group" "app_sg" {
  vpc_id = module.vpc.vpc_id
  
  ingress {
    cidr_blocks = [module.vpc.vpc_cidr_block]  # 10.10.0.0/16
    # ...
  }
}
```

---

## 9. Interview Questions

### Q1: What's the difference between public and private subnets?

> Public subnets have a route to the Internet Gateway and instances get public IPs. Private subnets route through NAT Gateway and instances have no public IPs - they can reach the internet but can't be reached FROM the internet.

### Q2: Why use multiple Availability Zones?

> High availability. If one data center (AZ) fails, your application continues running in the other AZ. The ALB automatically routes traffic to healthy instances.

### Q3: What's the difference between Internet Gateway and NAT Gateway?

> **IGW**: Bidirectional - allows traffic IN and OUT. Used by public subnets. Free.
> **NAT**: Outbound only - allows private instances to reach internet, blocks inbound. Costs ~$32/month.

### Q4: What does CIDR /24 mean?

> /24 means the first 24 bits are the network portion, leaving 8 bits for hosts. That's 2^8 = 256 addresses (251 usable after AWS reservations).

### Q5: Why is the NAT Gateway in a public subnet?

> The NAT Gateway needs to reach the internet (via IGW) to forward traffic from private subnets. It acts as an intermediary - receiving traffic from private subnets and sending it out through the IGW.

### Q6: What does `single_nat_gateway = true` mean?

> Use ONE NAT Gateway for all AZs instead of one per AZ. Saves ~$32/month but reduces availability - if that AZ fails, private subnets lose internet access. For production, use `false`.

### Q7: What happens if the route table doesn't have a route?

> The packet is dropped. Every subnet MUST have a route table. If there's no matching route for a destination, the traffic cannot flow.

### Q8: Can resources in different subnets communicate?

> Yes! All subnets in the same VPC can communicate via the "local" route (10.10.0.0/16 â†’ local). Security Groups control whether traffic is actually allowed.

---

## âœ… Part 2 Complete!

**Next: [Part 3 - Bastion Host](./Part3-Bastion-Host.md)**

Covers:
- AMI data source
- Security group rules (SSH, HTTP)
- Dynamic blocks
- User data script
- Why bastions exist